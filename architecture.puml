@startuml NeuroGraph-CodeRAG Architecture

!theme plain
left to right direction

skinparam componentStyle rectangle
skinparam linetype ortho
skinparam nodesep 100
skinparam ranksep 120
skinparam padding 25
skinparam arrowThickness 2

title Architecture Diagram - NeuroGraph-CodeRAG

' ============================================
' PRESENTATION LAYER
' ============================================
package "Presentation Layer" #E8F5E9 {
    [Input Handler] as Input
    [Streamlit UI] as UI
}

' ============================================
' APPLICATION LAYER
' ============================================
package "Application Layer" #E3F2FD {
    [Smart Agent Mode\n(LangGraph)] as Agent
}

' ============================================
' CORE PROCESSING
' ============================================
package "Structural Analysis" #FFF3E0 {
    [Multi-View Analyzer\n(AST, CFG, PDG)] as Analyzer
    [Repository Graph] as RepoGraph
}

package "Retrieval" #F3E5F5 {
    [RAG System\n(FAISS + CodeBERT)] as RAG
}

package "Model" #FCE4EC {
    [Gemma 2b with LoRA] as LLM
}

' ============================================
' DATA LAYER
' ============================================
package "Data Layer" #E0F2F1 {
    [Training Pipeline] as Training
    database "Datasets &\nCheckpoints" as Data
}

' ============================================
' MAIN FLOW
' ============================================
Input --> UI : "Code files"
UI --> Agent : "Code Input"
UI --> Analyzer : "Visualize structures"

Agent --> Analyzer

Analyzer --> RepoGraph : "Build call graph"
Analyzer --> RAG : "Retrieve examples"

RAG --> LLM : "Structural prompts"
RepoGraph --> LLM : "Context"

LLM --> Agent : "Summary/Critique"
Agent --> LLM : "Refine" 

Agent --> UI : "Display"

' ============================================
' TRAINING FLOW
' ============================================
Data --> Training
Training --> LLM : "Fine-tune"

@enduml
