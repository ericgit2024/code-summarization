@startuml
!theme plain
skinparam componentStyle rectangle

package "User Interface" {
  [Streamlit App] as UI
}

package "Repository Analysis" {
  [RepoAnalyzer] as RA
  [Dependency Graph] as DG
  [Call Graph] as CG
}

package "Structural Analysis" {
  [AST Extractor] as AST
  [CFG Builder] as CFG
  [PDG Builder] as PDG
}

package "Retrieval System (RAG)" {
  [RAGSystem] as RAG
  database "Vector DB (FAISS)" as VDB
  [Sentence Transformer] as ST
}

package "Inference Engine" {
  [InferencePipeline] as IP
  [Prompt Builder] as PB
  [Gemma Model (LoRA)] as LLM
}

' User Interaction
User -> UI : Provides Repo URL / Code
UI -> RA : Clones & Analyzes Repo
RA -> DG : Builds Dependency Graph
RA -> CG : Builds Call Graph
RA --> UI : Returns File List & Graphs

' Summarization Flow
User -> UI : Selects File/Function
UI -> RA : Extracts Code
RA --> UI : Returns Target Code
UI -> IP : summarize(code)

' Inference Pipeline
IP -> AST : get_structural_prompt(code)
IP -> CFG : get_cfg(code)
IP -> PDG : get_pdg(code)
AST --> IP : Structural Prompt
CFG --> IP : CFG Text
PDG --> IP : PDG Text

IP -> RAG : retrieve(code)
RAG -> ST : Encode Code
ST --> RAG : Embeddings
RAG -> VDB : Search Similar Code
VDB --> RAG : Retrieved Examples
RAG --> IP : Context (Code + Summaries)

IP -> PB : construct_prompt(Structure, Code, Context)
PB --> IP : Full Prompt
IP -> LLM : generate(Prompt)
LLM --> IP : Summary
IP --> UI : Returns Summary

@enduml
